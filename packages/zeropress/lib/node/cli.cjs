"use strict";var Ye=Object.create;var A=Object.defineProperty;var Ze=Object.getOwnPropertyDescriptor;var Je=Object.getOwnPropertyNames;var Ke=Object.getPrototypeOf,qe=Object.prototype.hasOwnProperty;var Qe=(e,t)=>{for(var o in t)A(e,o,{get:t[o],enumerable:!0})},Q=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Je(t))!qe.call(e,r)&&r!==o&&A(e,r,{get:()=>t[r],enumerable:!(n=Ze(t,r))||n.enumerable});return e};var s=(e,t,o)=>(o=e!=null?Ye(Ke(e)):{},Q(t||!e||!e.__esModule?A(o,"default",{value:e,enumerable:!0}):o,e)),Xe=e=>Q(A({},"__esModule",{value:!0}),e);var ct={};Qe(ct,{cli:()=>j});module.exports=Xe(ct);var v=s(require("path"),1),C=v.default.join(__dirname,"..",".."),I=v.default.join(C,"./src"),X=v.default.join(I,"./runtime"),D=v.default.join(X,"./client/client-entry.tsx"),ee=v.default.join(X,"./server/server-entry.tsx"),V=v.default.join(C,"./.zeropress"),P="./dist",E="./public",U=v.default.join(C,"./index.html"),te=["zeropress.config.ts","zeropress.config.js"],h={docs:"docs",title:"ZEROPRESS",description:"SSG Framework",themeConfig:{nav:[{text:"ZEROPRESS",link:"/",position:"left"}],autoNav:!0,autoSidebar:!0},icp:"",vite:{}},et=v.default.join(__dirname,".."),tt=v.default.join(et,"runtime"),re=v.default.join(tt,"./lazyWithPreload.js");var _=s(require("fs-extra"),1),S=s(require("path"),1),rt=e=>/\.mdx?/.test(e);function oe({siteConfig:e}){return{name:"vitePluginBuildImg",apply:"build",transform(t,o){let n=t;if(rt(o)&&t.includes("_components.img")){let r=S.default.dirname(o),[,i]=r.split("docs"),a=/_components\.img[^}]*?\bsrc:\s*["']([^"']+)["']/g;Array.from(t.matchAll(a),m=>m[1]).forEach(async m=>{let l=decodeURI(m);if(m.startsWith("./")){let c=S.default.join(encodeURI(i),m);n=n.replace(m,c);let f=S.default.join(r,l),g=S.default.join(e.root,P,i,l),u=await _.default.exists(f),x=await _.default.exists(g);u&&!x&&(await _.default.ensureDir(S.default.dirname(g)),await _.default.copyFile(f,g))}})}return n}}}var ie=require("acorn"),ne=s(require("github-slugger"),1),se=require("unist-util-visit"),ae=()=>e=>{let t=[];(0,se.visit)(e,"heading",i=>{if(i.depth>1&&i.depth<8){let p=i.children.map(c=>{switch(c.type){case"link":return c.children?.map(f=>f.value).join("")||"";default:return c.value}}).join(""),l=new ne.default().slug(p);t.push({id:l,text:p,depth:i.depth})}});let o=`export const GetToc = () => ${JSON.stringify(t,null,2)};`,r={type:"mdxjsEsm",value:"",data:{estree:(0,ie.parse)(o,{ecmaVersion:"latest",sourceType:"module"})}};e.children.unshift(r)};var me=s(require("@mdx-js/rollup"),1),le=s(require("rehype-autolink-headings"),1),pe=s(require("rehype-pretty-code"),1),ce=s(require("rehype-slug"),1),ue=s(require("remark-frontmatter"),1),de=s(require("remark-gfm"),1),fe=s(require("remark-mdx-frontmatter"),1);function ge(){let e=t=>/\.mdx?/.test(t);return{enforce:"pre",async handleHotUpdate(t){e(t.file)&&(console.log("\u81EA\u5B9A\u4E49hmr\u4E8B\u4EF6:",t.file),t.server.ws.send({type:"custom",event:"mdx?-update"}))},...(0,me.default)({remarkPlugins:[de.default,ue.default,fe.default,ae],rehypePlugins:[ce.default,[le.default,{properties:{class:"autolink-headings"},content:{type:"element",tagName:"span",properties:{style:"margin-right: 4px;"},children:[{type:"text",value:"#"}]}}],[pe.default,{theme:"github-light"}]]})}}var xe=s(require("fs-extra"),1);function ve({templatePath:e,entry:t}){return{name:"vitePluginServeHtml",apply:"serve",configureServer(o){return()=>{o.middlewares.use(async(n,r,i)=>{if(!n.url?.endsWith(".html")&&n.url!=="/")return i();let a=await xe.default.readFile(e,"utf-8"),m=(await o.transformIndexHtml?.(n.url,a,n.originalUrl)).replace("</body>",`
              <script type="module" src="${t}"></script>
              

              </body>
              `);r.statusCode=200,r.setHeader("Content-Type","text/html"),r.end(m)})}}}}var G=s(require("fs-extra"),1),he=s(require("mime"),1),W=s(require("path"),1),ot=e=>e?/\.(jpg|jpeg|png|gif|svg|webp)$/i.test(e):!1;function Pe({siteConfig:e}){return{name:"vite-plugin-fixed-image-dev",apply:"serve",configureServer(t){t.middlewares.use(async(o,n,r)=>{if(ot(o.url)){let i=decodeURI(o.url);if(!await G.default.exists(W.default.join(e.root,E,i))){let p=W.default.join(e.root,e.userConfig.docs,i),m=he.default.getType(p);m&&n.setHeader("Content-Type",m),G.default.createReadStream(p).pipe(n);return}}return r()})}}}function Ce(){let e=t=>/\.mdx?/.test(t);return{name:"vitePluginTransformFrontmatter",enforce:"post",transform(t,o){if(e(o))return t=t.replace("export const frontmatter","const frontmatter"),t+=`
 export const GetFrontMatter = () => frontmatter`,{code:t}}}}var ye=s(require("path"),1);function Te({siteConfig:e,restartRuntimeDevServer:t}){let o="virtual:config",n="\0"+o;return{name:"vitePluginVirtualConfig",resolveId(r){if(r===o)return n},load(r){if(r===n)return`export default ${JSON.stringify(e.userConfig)}`},async handleHotUpdate(r){let i=e.userConfigPath?ye.default.basename(e.userConfigPath):void 0;i&&r.file.includes(i)&&t&&(console.log("\u76D1\u542C\u5230\u914D\u7F6E\u6587\u4EF6\u66F4\u65B0\uFF0C\u91CD\u542F\u670D\u52A1\u4E2D:",r.file),await t())}}}var Se=require("cross-spawn"),Re=s(require("dayjs"),1),we=s(require("fast-glob"),1),Ie=s(require("fs-extra"),1),Y=s(require("path"),1);async function k(e=h.docs,t){return await we.default.glob("**/*.{jsx,tsx,md,mdx}",{ignore:["node_modules/**","client/**","server/**"],cwd:e,deep:3,...t})}var be=new Map;function Ee(e){let t=be.get(e);return t||(Ie.default.existsSync(e)?new Promise((o,n)=>{let r=(0,Se.spawn)("git",["log","-1",'--pretty="%ai"',Y.default.basename(e)],{cwd:Y.default.dirname(e)}),i="";r.stdout.on("data",a=>i+=String(a)),r.on("close",()=>{if(i){let a=(0,Re.default)(i).unix();be.set(e,a),o(a)}else o(void 0)}),r.on("error",n)}):0)}async function Z(e,t,o){let n=new Array(e.length),r=[];for(let i=0;i<e.length;i++){let a=e[i],p=(async()=>{let m=await o(a);n[i]=m})();r.push(p),r.length>=t&&await Promise.race(r)}return await Promise.all(r),n}function y(e="/"){return encodeURI(e)}function M(e){return e&&e+".html"}function $(e,t){return e.reduce((o,n)=>{let r=n[t];return o[r]||(o[r]=[]),o[r].push(n),o},{})}function J(e,t){return e.reduce((o,n)=>{let r=n[t];return o[r]=n,o},{})}function F(e){let t=e?.match(/^(\d+)(\.?\s*)(.*)$/),o=t?.[1];return o?{index:parseInt(o),text:t?.[3]??""}:{index:0,text:e??""}}var _e=s(require("fs"),1),K=s(require("path"),1),it=_e.default.readFileSync(re,"utf-8");function Oe({siteConfig:e,isServer:t}){let o="virtual:routes",n="\0"+o,r=e.userConfig.docs;return{name:"vitePluginVirtualRoutes",resolveId(i){if(i===o)return n},async load(i){if(i===n){let a=await k(r,{absolute:!0}),p=`import React from "react";
`,m=await Promise.all(a.map(async(l,c)=>{let g=K.default.relative(r,l).replace(K.default.extname(l),"").replace(/index$/,"");p+=t?`import Element${c+1} from '${l}';
`:`const Element${c+1} = lazyWithPreload(()=> import('${l}'));
`;let u=await Ee(l);return`{
            file:'${l}', 
            timestamp:'${u??""}', 
            path: '/${y(M(g))}', 
            element: React.createElement(Element${c+1}), 
            preload: ${t?`()=>Element${c+1}`:`()=> Element${c+1}.preload()`}
            },
`}));return`
        ${it.toString()}
        ${p}
        export default [${m.join("")}]
        `}}}}var je=s(require("@vitejs/plugin-react"),1);function L({siteConfig:e,restartRuntimeDevServer:t,isServer:o}){return[ge(),(0,je.default)({include:/\.(md|mdx|js|jsx|ts|tsx)$/}),ve({templatePath:U,entry:D}),Te({siteConfig:e,restartRuntimeDevServer:t}),Oe({siteConfig:e,isServer:o}),Ce(),oe({siteConfig:e}),Pe({siteConfig:e})]}var He=require("@iconify/tailwind"),Ne=s(require("path"),1),z={content:[Ne.default.join(__dirname,"..","..","./src/default-theme/**/*.{tsx,ts,jsx,js}")],darkMode:"selector",theme:{extend:{screens:{pc:"768px",full:"1060px"},colors:{divider:"var(--ep-color-divider)",brand:"var(--ep-color-brand)",bg:{default:"var(--ep-color-bg-default)",switch:"var(--ep-color-bg-switch)",inverse:"var(--ep-color-bg-inverse)",sidebar:"var(--ep-color-bg-sidebar)"},text:{1:"var(--ep-color-text-1)",2:"var(--ep-color-text-2)",3:"var(--ep-color-text-3)",4:"var(--ep-color-text-4)"},gray:{1:"var(--ep-color-gray-1)"}},boxShadow:{1:"0 1px 2px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06)",2:"0 3px 12px rgba(0, 0, 0, 0.07), 0 1px 4px rgba(0, 0, 0, 0.07)",3:"0 12px 32px rgba(0, 0, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.08)",4:"0 14px 44px rgba(0, 0, 0, 0.12), 0 3px 9px rgba(0, 0, 0, 0.12)",5:"0 18px 56px rgba(0, 0, 0, 0.16), 0 4px 12px rgba(0, 0, 0, 0.16)"},spacing:{nav:"56px",sidebar:"250px",toc:"200px"}}},plugins:[(0,He.addDynamicIconSelectors)()]};var Ae=s(require("autoprefixer"),1),T=s(require("fs-extra"),1),b=s(require("path"),1),De=s(require("tailwindcss"),1),Ue=require("vite");async function ke({siteConfig:e}){console.log("\u5220\u9664\u65E7\u4EA7\u7269\uFF1A",P),await T.default.remove(P),console.log("\u6784\u5EFAjs\u6587\u4EF6...");let[t,o]=await Z([{siteConfig:e},{siteConfig:e,isServer:!0}],10,nt);console.log("\u6784\u5EFAhtml\u6587\u4EF6..."),await st({siteConfig:e,clientBundle:t,serverBundle:o})}function nt({isServer:e=!1,siteConfig:t}){return(0,Ue.build)({mode:"production",base:"./",root:C,plugins:L({siteConfig:t,isServer:e}),build:{ssr:e,outDir:e?V:b.default.join(t.root,P),rollupOptions:{input:e?ee:D,output:{entryFileNames:e?"server-entry.cjs":"client-entry.[hash].js",format:e?"cjs":"es"}}},css:{postcss:{plugins:[(0,De.default)(z),(0,Ae.default)({})]}},resolve:{alias:{"@":I}}})}async function st({clientBundle:e,serverBundle:t,siteConfig:o}){let n=e.output.find(u=>u.type==="chunk"&&u.isEntry),r=t.output.find(u=>u.type==="chunk"&&u.isEntry);if(!n||!r)throw new Error("\u6784\u5EFA\u4EA7\u7269\u4E3A\u7A7A");let i=e.output.filter(u=>u.type==="asset"&&u.fileName.endsWith(".css"));await T.default.exists(E)&&await T.default.copy(E,b.default.join(P));let a=b.default.join(V,r?.fileName),p=`/${n?.fileName}`,m={},{render:l,routes:c}=await import(a),{helmet:f}=m,g=await T.default.readFile(U,"utf-8");await Z(c,10,async u=>{let x=u.path==="/"?"/index.html":u.path,H=`${P}${x}`,B={},R=await l(u.path||"/",B),N=g.replace("<title>ZEROPRESS</title>",f?.title?.toString()||"").replace("<!--app-html-->",R).replace("</body>",`
    <script type="module" src="${p}"></script>
    </body>
    `).replace("</head>",i.map(w=>`<link rel="stylesheet" href="/${w.fileName}">`).join(`
`));T.default.ensureDir(b.default.join(o.root,b.default.dirname(H))).catch(w=>console.log("client\u6587\u4EF6\u5939\u4E0D\u5B58\u5728\uFF1A",w)).then(()=>T.default.writeFile(b.default.join(o.root,H),N)).catch(w=>console.log("html\u5199\u5165\u5931\u8D25",w))})}var Me=s(require("fs-extra"),1),O=s(require("path"),1),$e=require("vite");async function q({root:e=process.cwd(),command:t,mode:o}){let{userConfigPath:n,userConfig:r={}}=await mt({root:e,mode:o,command:t}),i=r.docs??h.docs,a=await at({docs:i}),p=r.themeConfig?.nav?.findIndex(x=>x.position==="left")??0,m=r.themeConfig?.autoNav===!1?r.themeConfig.nav??[]:[...(r.themeConfig?.nav??[]).slice(0,p),...a.nav,...(r.themeConfig?.nav??[]).slice(p)],l=r.themeConfig?.autoSidebar===!1?r.themeConfig.sidebar??{}:a.sidebar,c=m.map(x=>({...x,link:y(x.link)})),f=Object.entries(l).reduce((x,[H,B])=>(x[y(H)]=B.map(R=>({...R,link:y(R.link),items:R.items?.map(N=>({...N,link:y(N.link)}))})),x),{}),g={docs:i,title:r.title??h.title,description:r.description??h.description,icp:r.icp??h.icp,themeConfig:r.themeConfig?{...r.themeConfig,nav:c,sidebar:f,autoNav:!0,autoSidebar:!0}:{...h.themeConfig,nav:c,sidebar:f,autoNav:!0,autoSidebar:!0},vite:r.vite??h.vite};return{root:e,userConfigPath:n,userConfig:g}}async function at({docs:e}){let o=(await k(e)).filter(i=>!i.includes("index.md")).map(i=>{let a=i.split("/")[0],p=i.split("/")[1],m=i.split("/")[2],l=F(a),c=F(p),f=F(m);return{path:`/${M(i.replace(O.default.extname(i),""))}`,nav:a,dir:p,file:m,navIndex:l.index,navText:l.text,navPath:`/${a}`,siderbarDirIndex:c.index,siderbarDirText:c.text.replace(O.default.extname(c.text),""),fileIndex:f.index,fileText:f.text.replace(O.default.extname(f.text),"")}}),n=Object.entries($(o,"navText")).map(([i,a])=>({text:i,index:J(a,"navText")[i].navIndex,link:a.sort((p,m)=>p.siderbarDirIndex-m.siderbarDirIndex+p.fileIndex-m.fileIndex)[0].path})).sort((i,a)=>i.index-a.index),r=Object.entries($(o,"navPath")).reduce((i,[a,p])=>{let m=Object.entries($(p,"siderbarDirText")).reduce((l,[c,f])=>(l[c]=f.sort((g,u)=>g.fileIndex-u.fileIndex).map(g=>({text:g.fileText,link:g.path})).filter(g=>g.text),l),{});return i[a]=Object.values(J(p.sort((l,c)=>l.siderbarDirIndex-c.siderbarDirIndex).map(l=>({text:l.siderbarDirText,items:m[l.siderbarDirText],link:l.path})),"text")),i},{});return{nav:n,sidebar:r}}async function mt({root:e=process.cwd(),command:t,mode:o}){let n=lt({root:e}),r=await(0,$e.loadConfigFromFile)({command:t,mode:o},n,e);return{userConfigPath:n,userConfig:r?.config}}function lt({root:e=process.cwd()}){return te.map(o=>O.default.join(e,o)).find(o=>Me.default.existsSync(o))}var Fe=s(require("autoprefixer"),1),Le=s(require("tailwindcss"),1),ze=require("vite");function Be({siteConfig:e,restartRuntimeDevServer:t}){return(0,ze.createServer)({root:e.root,server:{host:!0},plugins:L({restartRuntimeDevServer:t,siteConfig:e}),css:{postcss:{plugins:[(0,Le.default)(z),(0,Fe.default)({})]}},resolve:{alias:{"@":I}},optimizeDeps:{include:["zeropress > react-fast-compare","zeropress > classnames","zeropress > invariant","zeropress > shallowequal","zeropress > dayjs","zeropress > react-dom/client"],exclude:["@/runtime","@/node","@/default-theme","@/shared"]}})}var Ve=require("commander"),Ge=s(require("fs-extra"),1),We=s(require("path"),1),j=Ve.program,{version:pt}=Ge.default.readJSONSync(We.default.join(C,"./package.json"));j.name("zeropress").version(pt);j.command("dev",{isDefault:!0}).description("dev server").option("-p,--port <value>","dev server port").action(async({port:e})=>{let t=async()=>{let o=await q({mode:"development",command:"serve"}),n=await Be({siteConfig:o,restartRuntimeDevServer:async()=>{await n.close(),await t()}});await n.listen(e),n.printUrls();let r=!1;n.watcher.on("all",async(i,a)=>{!r&&i!=="change"&&(console.log("\u76D1\u542C\u5230\u6587\u4EF6\u589E\u5220\u6539\uFF0C\u91CD\u542F\u670D\u52A1\u4E2D:",a),r=!0,await n.close(),await t(),r=!1)})};await t()});j.command("build").description("build").action(async()=>{try{let e=await q({mode:"production",command:"build"});await ke({siteConfig:e}),console.log("\u6784\u5EFA\u6210\u529F")}catch(e){console.log(e)}});j.parse();0&&(module.exports={cli});
//# sourceMappingURL=cli.cjs.map